<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>系统设计::粗略评估 | Y.CH.Y</title><link rel=canonical href=/notes/system_design_interview_02/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="系统设计::粗略评估"><meta property="og:description" content="粗略评估 在系统设计面试中，有时你会被要求用粗略评估系统容量或性能要求。根据 Google 高级研究员 Jeff Dean 的说法，&ldquo;粗略计算是你使用思想实验和常见的性能数字的组合来创建的估计，以很好地感觉到哪些设计可以满足你的要求&rdquo;
你需要对可扩展性的基础知识有一个很好的感觉，以便有效地进行粗略计算。你需要好地理解以下概念：二的幂，每个程序员都应该知道的延迟数字，以及可用性数字。
2 的幂 尽管在处理分布式系统时，数据量可能变得巨大，但计算都可以归结为基础知识。为了获得正确的计算结果，关键是要知道使用 2 的幂的数据量单位。一个字节是一个 8 位的序列。一个 ASCII 字符使用一个字节的内存（8 比特）。下面是一个解释数据量单位的表格
Power Approximate value Full name Short name 10 1 Thousand 1 Kilobyte 1 KB 20 1 Million 1 Megabyte 1 MB 30 1 Billion 1 Gigabyte 1 GB 40 1 Trillion 1 Terabyte 1 TB 50 1 Quadrillion 1 Petabyte 1 PB 每个程序都应该知道的延迟数字 来自谷歌的 Dr.Dean 展示了 2010 年典型计算机操作的时间长度。随着计算机变得更快、更强大，有些数字已经过时了。然而，这些数字应该仍然能够让我们了解不同计算机操作的快慢。
Operation name Time L1 cache reference 0."><meta property="og:type" content="article"><meta property="og:url" content="/notes/system_design_interview_02/"><meta property="article:section" content="notes"><meta property="article:published_time" content="2021-02-02T22:20:24+08:00"><meta property="article:modified_time" content="2021-02-02T22:20:24+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="系统设计::粗略评估"><meta name=twitter:description content="粗略评估 在系统设计面试中，有时你会被要求用粗略评估系统容量或性能要求。根据 Google 高级研究员 Jeff Dean 的说法，&ldquo;粗略计算是你使用思想实验和常见的性能数字的组合来创建的估计，以很好地感觉到哪些设计可以满足你的要求&rdquo;
你需要对可扩展性的基础知识有一个很好的感觉，以便有效地进行粗略计算。你需要好地理解以下概念：二的幂，每个程序员都应该知道的延迟数字，以及可用性数字。
2 的幂 尽管在处理分布式系统时，数据量可能变得巨大，但计算都可以归结为基础知识。为了获得正确的计算结果，关键是要知道使用 2 的幂的数据量单位。一个字节是一个 8 位的序列。一个 ASCII 字符使用一个字节的内存（8 比特）。下面是一个解释数据量单位的表格
Power Approximate value Full name Short name 10 1 Thousand 1 Kilobyte 1 KB 20 1 Million 1 Megabyte 1 MB 30 1 Billion 1 Gigabyte 1 GB 40 1 Trillion 1 Terabyte 1 TB 50 1 Quadrillion 1 Petabyte 1 PB 每个程序都应该知道的延迟数字 来自谷歌的 Dr.Dean 展示了 2010 年典型计算机操作的时间长度。随着计算机变得更快、更强大，有些数字已经过时了。然而，这些数字应该仍然能够让我们了解不同计算机操作的快慢。
Operation name Time L1 cache reference 0."><link rel=stylesheet href=/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><link rel=stylesheet href=/css/custom.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=/images/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-X1L70M4MM0","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=/><div id=logo style=background-image:url(/images/logo.png)></div><div id=title><h1>Y.CH.Y</h1></div></a><div id=nav><ul><li class=icon><a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a></li><li><a href=/>首页</a></li><li><a href=/books>笔记</a></li></ul></div></header><article class=post itemscope itemtype=http://schema.org/BlogPosting><div class=content itemprop=articleBody><h2 id=粗略评估>粗略评估</h2><p>在系统设计面试中，有时你会被要求用粗略评估系统容量或性能要求。根据 Google 高级研究员 Jeff Dean 的说法，&ldquo;粗略计算是你使用思想实验和常见的性能数字的组合来创建的估计，以很好地感觉到哪些设计可以满足你的要求&rdquo;</p><p>你需要对可扩展性的基础知识有一个很好的感觉，以便有效地进行粗略计算。你需要好地理解以下概念：二的幂，每个程序员都应该知道的延迟数字，以及可用性数字。</p><h3 id=2-的幂>2 的幂</h3><p>尽管在处理分布式系统时，数据量可能变得巨大，但计算都可以归结为基础知识。为了获得正确的计算结果，关键是要知道使用 2 的幂的数据量单位。一个字节是一个 8 位的序列。一个 ASCII 字符使用一个字节的内存（8 比特）。下面是一个解释数据量单位的表格</p><table><thead><tr><th>Power</th><th>Approximate value</th><th>Full name</th><th>Short name</th></tr></thead><tbody><tr><td>10</td><td>1 Thousand</td><td>1 Kilobyte</td><td>1 KB</td></tr><tr><td>20</td><td>1 Million</td><td>1 Megabyte</td><td>1 MB</td></tr><tr><td>30</td><td>1 Billion</td><td>1 Gigabyte</td><td>1 GB</td></tr><tr><td>40</td><td>1 Trillion</td><td>1 Terabyte</td><td>1 TB</td></tr><tr><td>50</td><td>1 Quadrillion</td><td>1 Petabyte</td><td>1 PB</td></tr></tbody></table><h3 id=每个程序都应该知道的延迟数字>每个程序都应该知道的延迟数字</h3><p>来自谷歌的 Dr.Dean 展示了 2010 年典型计算机操作的时间长度。随着计算机变得更快、更强大，有些数字已经过时了。然而，这些数字应该仍然能够让我们了解不同计算机操作的快慢。</p><table><thead><tr><th>Operation name</th><th>Time</th></tr></thead><tbody><tr><td>L1 cache reference</td><td>0.5 ns</td></tr><tr><td>Branch mispredict</td><td>5 ns</td></tr><tr><td>L2 cache reference</td><td>7 ns</td></tr><tr><td>Mutex lock/unlock</td><td>100 ns</td></tr><tr><td>Main memory reference</td><td>100 ns</td></tr><tr><td>Compress 1K bytes with Zippy</td><td>10,000 ns = 10 us</td></tr><tr><td>Send 2K bytes over 1 Gbps network</td><td>20,000 ns = 20 us</td></tr><tr><td>Read 1 MB sequentially from memory</td><td>250,000 ns = 250 us</td></tr><tr><td>Round trip within the same datacenter</td><td>500,000 ns = 500 us</td></tr><tr><td>Disk seek</td><td>10,000,000 ns = 10 ms</td></tr><tr><td>Read 1 MB sequentially from the network</td><td>10,000,000 ns = 10 ms</td></tr><tr><td>Read 1 MB sequentially from disk</td><td>30,000,000 ns = 30 ms</td></tr><tr><td>Send packet CA (California) -> Netherlands-> CA</td><td>150,000,000 ns = 150 ms</td></tr></tbody></table><p>一位谷歌软件工程师建立了一个工具，将 Dr.Dean 的数字可视化。该工具还将时间因素考虑在内。下图显示了截至 2020 年的可视化延迟数字</p><img src=../../system_design_interview/index-37_1.jpg width=100%><ul><li>内存很快，但磁盘很慢。</li><li>如果可能的话，要避免磁盘搜索。</li><li>简单的压缩算法是快速的。</li><li>如果可能的话，在通过互联网发送数据之前先进行压缩。</li><li>数据中心通常在不同地区，在它们之间发送数据需要时间。</li></ul><h3 id=可用性>可用性</h3><p>高可用性是指一个系统在一个理想的长时期内持续运行的能力。高可用性是以百分比来衡量的，100%意味着一个服务没有停机时间。大多数服务在 99%和 100%之间。</p><p>服务水平协议（SLA）是服务提供者的一个常用术语。这是你（服务提供商）和你的客户之间的协议，这个协议正式定义了你的服务将提供的正常运行时间水平。云服务提供商亚马逊、谷歌和微软将其 SLA 设定为 99.9% 或以上。正常运行时间传统上是以 9 的个数为单位衡量的。9 个数多，越好。如下表所示，9 的个数与预期系统停机时间相关。</p><table><thead><tr><th>Availability %</th><th>Downtime per day</th><th>Downtime per year</th></tr></thead><tbody><tr><td>99%</td><td>14.40 minutes</td><td>3.65 days</td></tr><tr><td>99.9%</td><td>1.44 minutes</td><td>8.77 hours</td></tr><tr><td>99.99%</td><td>8.64 seconds</td><td>52.60 minutes</td></tr><tr><td>99.999%</td><td>864.00 milliseconds</td><td>5.26 minutes</td></tr><tr><td>99.9999%</td><td>86.40 milliseconds</td><td>31.56 seconds</td></tr></tbody></table><h3 id=例子评估-twitter-的-qps-和存储需求>例子:评估 Twitter 的 QPS 和存储需求</h3><p>请注意，以下数字仅用于本练习，因为它们不是 Twitter 的真实数字。</p><ul><li>假设。<ul><li>每月有 3 亿活跃用户。</li><li>50%的用户每天使用 Twitter。</li><li>用户平均每天发布 2 条推文。</li><li>10%的推文包含媒体。</li><li>数据存储时间为 5 年。估算。</li></ul></li><li>每秒查询次数（QPS）估计。<ul><li>日活跃用户（DAU）=3 亿*50%=1.5 亿</li><li>推文 QPS = 1.5 亿 * 2 条推文/24 小时/3600 秒 = ~3500</li><li>Peek QPS = 2 * QPS = ~7000</li></ul></li><li>我们在此只估算媒体存储量。<ul><li>平均推文大小。<ul><li>tweet_id 64 bytes</li><li>文本 140 字节</li><li>媒体 1 MB</li></ul></li><li>媒体存储。1.5 亿<em>2</em>10%*1MB=30TB/天</li><li>5 年的媒体存储。30 TB * 365 * 5 = ~55 PB</li></ul></li></ul><h3 id=技巧>技巧</h3><p>粗略估计是关于过程的。解决问题比获得结果更重要。面试官可能会测试你解决问题的能力。这里有几个技巧可以借鉴。</p><ul><li>四舍五入和近似。在面试中很难进行复杂的数学运算。例如，&ldquo;99987 / 9.1 &ldquo;的结果是什么？没有必要花费宝贵的时间来解决复杂的数学问题。精度不被期待。使用整数和近似值对你有利。这个除法问题可以简化如下。&ldquo;100,000 / 10&rdquo;.</li><li>写下你的假设。写下你的假设是个好主意，以便以后参考。</li><li>标记你的单位。当你写下 &ldquo;5 &ldquo;时，它是指 5KB 还是 5MB？你可能会因此而迷惑自己。写下单位，因为 &ldquo;5 MB &ldquo;有助于消除歧义。</li><li>常见的粗略估算法。QPS，峰值 QPS，存储，缓存，服务器的数量，等等。你可以在准备面试的时候练习这些计算方法。实践出真知。</li></ul><p>恭喜你走到这一步! 现在给自己拍拍背吧。干得好!</p></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2023 Y.CH.Y</div><div class=footer-right><nav><ul><li><a href=/>首页</a></li><li><a href=/books>笔记</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script></html>