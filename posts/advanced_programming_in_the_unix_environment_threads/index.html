<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>APUE::Threads | Y.CH.Y</title><link rel=canonical href=/posts/advanced_programming_in_the_unix_environment_threads/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="APUE::Threads"><meta property="og:description" content="Threads Thread Concepts simplify code that deals with asynchronous events by assigning a separate thread to handle each event type Threads automatically have access to the same memory address space and file descriptors Some problems can be partitioned so that overall program throughput can be improved interactive programs can realize improved response time by using multiple threads The benefits of a multithreaded programming model can be realized even if your program is running on a uniprocessor A thread consists of the information necessary to represent an execution context within a process a thread ID that identifies the thread within a process a set of register values a stack a scheduling priority and policy a signal mask an errno variable thread-specific data Everything within a process is sharable among the threads in a process text of the executable program the program’s global and heap memory, the stacks the file descriptors Thread Identification every thread has a thread ID the thread ID has significance only within the context of the process to which it belongs A thread ID is represented by the pthread_t data type Thread Creation When a thread is created, there is no guarantee which will run first: the newly created thread or the calling thread The memory location pointed to by tidp is set to the thread ID of the newly created thread when pthread_create returns successfully pthread functions usually return an error code when they fail."><meta property="og:type" content="article"><meta property="og:url" content="/posts/advanced_programming_in_the_unix_environment_threads/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-11T00:43:37+08:00"><meta property="article:modified_time" content="2021-08-11T00:43:37+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="APUE::Threads"><meta name=twitter:description content="Threads Thread Concepts simplify code that deals with asynchronous events by assigning a separate thread to handle each event type Threads automatically have access to the same memory address space and file descriptors Some problems can be partitioned so that overall program throughput can be improved interactive programs can realize improved response time by using multiple threads The benefits of a multithreaded programming model can be realized even if your program is running on a uniprocessor A thread consists of the information necessary to represent an execution context within a process a thread ID that identifies the thread within a process a set of register values a stack a scheduling priority and policy a signal mask an errno variable thread-specific data Everything within a process is sharable among the threads in a process text of the executable program the program’s global and heap memory, the stacks the file descriptors Thread Identification every thread has a thread ID the thread ID has significance only within the context of the process to which it belongs A thread ID is represented by the pthread_t data type Thread Creation When a thread is created, there is no guarantee which will run first: the newly created thread or the calling thread The memory location pointed to by tidp is set to the thread ID of the newly created thread when pthread_create returns successfully pthread functions usually return an error code when they fail."><link rel=stylesheet href=/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><link rel=stylesheet href=/css/custom.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=/images/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-X1L70M4MM0","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>首页</a></li><li><a href=/books>笔记</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=/posts/advanced_programming_in_the_unix_environment_overview/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=/posts/tao_of_programming/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&text=APUE%3a%3aThreads" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&title=APUE%3a%3aThreads" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&is_video=false&description=APUE%3a%3aThreads" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=APUE%3a%3aThreads&body=Check out this article: %2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&title=APUE%3a%3aThreads" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&title=APUE%3a%3aThreads" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&name=APUE%3a%3aThreads&description=Threads%20Thread%20Concepts%20simplify%20code%20that%20deals%20with%20asynchronous%20events%20by%20assigning%20a%20separate%20thread%20to%20handle%20each%20event%20type%20Threads%20automatically%20have%20access%20to%20the%20same%20memory%20address%20space%20and%20file%20descriptors%20Some%20problems%20can%20be%20partitioned%20so%20that%20overall%20program%20throughput%20can%20be%20improved%20interactive%20programs%20can%20realize%20improved%20response%20time%20by%20using%20multiple%20threads%20The%20benefits%20of%20a%20multithreaded%20programming%20model%20can%20be%20realized%20even%20if%20your%20program%20is%20running%20on%20a%20uniprocessor%20A%20thread%20consists%20of%20the%20information%20necessary%20to%20represent%20an%20execution%20context%20within%20a%20process%20a%20thread%20ID%20that%20identifies%20the%20thread%20within%20a%20process%20a%20set%20of%20register%20values%20a%20stack%20a%20scheduling%20priority%20and%20policy%20a%20signal%20mask%20an%20errno%20variable%20thread-specific%20data%20Everything%20within%20a%20process%20is%20sharable%20among%20the%20threads%20in%20a%20process%20text%20of%20the%20executable%20program%20the%20program%e2%80%99s%20global%20and%20heap%20memory%2c%20the%20stacks%20the%20file%20descriptors%20Thread%20Identification%20every%20thread%20has%20a%20thread%20ID%20the%20thread%20ID%20has%20significance%20only%20within%20the%20context%20of%20the%20process%20to%20which%20it%20belongs%20A%20thread%20ID%20is%20represented%20by%20the%20pthread_t%20data%20type%20Thread%20Creation%20When%20a%20thread%20is%20created%2c%20there%20is%20no%20guarantee%20which%20will%20run%20first%3a%20the%20newly%20created%20thread%20or%20the%20calling%20thread%20The%20memory%20location%20pointed%20to%20by%20tidp%20is%20set%20to%20the%20thread%20ID%20of%20the%20newly%20created%20thread%20when%20pthread_create%20returns%20successfully%20pthread%20functions%20usually%20return%20an%20error%20code%20when%20they%20fail." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&t=APUE%3a%3aThreads" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ol><li><ol><li><a href=#threads>Threads</a></li></ol></li></ol></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">APUE::Threads</h1><div class=meta><div class=postdate><time datetime="2021-08-11 00:43:37 +0800 +0800" itemprop=datePublished>2021 Aug 11</time></div></div></header><div class=content itemprop=articleBody><h2 id=threads>Threads</h2><ul><li>Thread Concepts<ul><li>simplify code that deals with asynchronous events by assigning a separate thread to handle each event type</li><li>Threads automatically have access to the same memory address space and file descriptors</li><li>Some problems can be partitioned so that overall program throughput can be improved</li><li>interactive programs can realize improved response time by using multiple threads</li><li>The benefits of a multithreaded programming model can be realized even if your program is running on a uniprocessor</li><li>A thread consists of the information necessary to represent an execution context within a process<ul><li>a thread ID that identifies the thread within a process</li><li>a set of register values</li><li>a stack</li><li>a scheduling priority and policy</li><li>a signal mask</li><li>an errno variable</li><li>thread-specific data</li></ul></li><li>Everything within a process is sharable among the threads in a process<ul><li>text of the executable program</li><li>the program’s global and heap memory, the stacks</li><li>the file descriptors</li></ul></li></ul></li><li>Thread Identification<ul><li>every thread has a thread ID</li><li>the thread ID has significance only within the context of the process to which it belongs</li><li>A thread ID is represented by the pthread_t data type</li></ul></li><li>Thread Creation<ul><li>When a thread is created, there is no guarantee which will run first: the newly created thread or the calling thread</li><li>The memory location pointed to by tidp is set to the thread ID of the newly created thread when pthread_create returns successfully</li><li>pthread functions usually return an error code when they fail. They don’t set errno like the other POSIX functions</li></ul></li><li>Thread Termination<ul><li>If any thread within a process calls exit, _Exit, or _exit, then the entire process terminates</li><li>the default action is to terminate the process, a signal sent to a thread will terminate the entire process</li><li>A single thread can exit in three ways, thereby stopping its flow of control, without terminating the entire process<ul><li>The thread can simply return from the start routine. The return value is the thread’s exit code</li><li>The thread can be canceled by another thread in the same process</li><li>The thread can call pthread_exit</li></ul></li><li>One thread can request that another in the same process be canceled by calling the pthread_cancel function<ul><li>However, a thread can elect to ignore or otherwise control how it is canceled</li><li>thread_cancel doesn’t wait for the thread to terminate; it merely makes the request</li></ul></li><li>A thread can arrange for functions to be called when it exits pthread_cleanup_push<ul><li>Makes a call to pthread_exit</li><li>Responds to a cancellation request</li><li>Makes a call to pthread_cleanup_pop with a nonzero execute argument</li></ul></li><li>Thread Synchronization<ul><li>When multiple threads of control share the same memory, we need to make sure that each thread sees a consistent view of its data</li><li>Mutexes<ul><li>A mutex is basically a lock that we set (lock) before accessing a shared resource and release (unlock) when we’re done</li><li>we must first initialize it by either setting it to the constant PTHREAD_MUTEX_INITIALIZER (for statically allocated mutexes only) or calling pthread_mutex_init</li><li>To lock a mutex, we call pthread_mutex_lock</li><li>To unlock a mutex, we call pthread_mutex_unlock</li></ul></li></ul></li><li>Deadlock Avoidance<ul><li>Deadlocks can be avoided by carefully controlling the order in which mutexes are locked</li><li>assume that you have two mutexes, A and B, that you need to lock at the same time. If all threads always lock mutex A before mutex B, no deadlock can occur from the use of the two mutexes</li></ul></li><li>pthread_mutex_timedlock<ul><li>The timeout specifies how long we are willing to wait in terms of absolute time (as opposed to relative time; we specify that we are willing to block until time X instead of saying that we are willing to block for Y seconds)</li></ul></li><li>Reader–writer locks<ul><li>Only one thread at a time can hold a reader–writer lock in write mode, but multiple threads can hold a reader–writer lock in read mode at the same time</li><li>Reader–writer locks are well suited for situations in which data structures are read more often than they are modified</li></ul></li><li>Reader–Writer Locking with Timeouts<ul><li>pthread_rwlock_timedwrlock</li></ul></li><li>Condition Variables<ul><li>When used with mutexes, condition variables allow threads to wait in a race-free way for arbitrary conditions to occur</li></ul></li><li>Spin Locks<ul><li>the process is blocked by busy-waiting (spinning) until the lock can be acquired<ul><li>A spin lock could be used in situations where locks are held for short periods of times and threads don’t want to incur the cost of being descheduled</li></ul></li><li>Many mutex implementations are so efficient that the performance of applications using mutex locks is equivalent to their performance if they had used spin locks</li><li>The interfaces for spin locks are similar to those for mutexes, making it relatively easy to replace one with the other</li><li>if a spin lock is currently unlocked, then the pthread_spin_lock function can lock it without spinning. If the thread already has it locked, the results are undefined. The call to pthread_spin_lock could fail with the EDEADLK error (or some other error), or the call could spin indefinitely. The behavior depends on the implementation. If we try to unlock a spin lock that is not locked, the results are also undefined</li></ul></li><li>Barriers<ul><li>Barriers are a synchronization mechanism that can be used to coordinate multiple threads working in parallel</li><li>A barrier allows each thread to wait until all cooperating threads have reached the same point, and then continue executing from there</li></ul></li></ul></li></ul></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>首页</a></li><li><a href=/books>笔记</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ol><li><ol><li><a href=#threads>Threads</a></li></ol></li></ol></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&text=APUE%3a%3aThreads" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&title=APUE%3a%3aThreads" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&is_video=false&description=APUE%3a%3aThreads" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=APUE%3a%3aThreads&body=Check out this article: %2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&title=APUE%3a%3aThreads" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&title=APUE%3a%3aThreads" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&name=APUE%3a%3aThreads&description=Threads%20Thread%20Concepts%20simplify%20code%20that%20deals%20with%20asynchronous%20events%20by%20assigning%20a%20separate%20thread%20to%20handle%20each%20event%20type%20Threads%20automatically%20have%20access%20to%20the%20same%20memory%20address%20space%20and%20file%20descriptors%20Some%20problems%20can%20be%20partitioned%20so%20that%20overall%20program%20throughput%20can%20be%20improved%20interactive%20programs%20can%20realize%20improved%20response%20time%20by%20using%20multiple%20threads%20The%20benefits%20of%20a%20multithreaded%20programming%20model%20can%20be%20realized%20even%20if%20your%20program%20is%20running%20on%20a%20uniprocessor%20A%20thread%20consists%20of%20the%20information%20necessary%20to%20represent%20an%20execution%20context%20within%20a%20process%20a%20thread%20ID%20that%20identifies%20the%20thread%20within%20a%20process%20a%20set%20of%20register%20values%20a%20stack%20a%20scheduling%20priority%20and%20policy%20a%20signal%20mask%20an%20errno%20variable%20thread-specific%20data%20Everything%20within%20a%20process%20is%20sharable%20among%20the%20threads%20in%20a%20process%20text%20of%20the%20executable%20program%20the%20program%e2%80%99s%20global%20and%20heap%20memory%2c%20the%20stacks%20the%20file%20descriptors%20Thread%20Identification%20every%20thread%20has%20a%20thread%20ID%20the%20thread%20ID%20has%20significance%20only%20within%20the%20context%20of%20the%20process%20to%20which%20it%20belongs%20A%20thread%20ID%20is%20represented%20by%20the%20pthread_t%20data%20type%20Thread%20Creation%20When%20a%20thread%20is%20created%2c%20there%20is%20no%20guarantee%20which%20will%20run%20first%3a%20the%20newly%20created%20thread%20or%20the%20calling%20thread%20The%20memory%20location%20pointed%20to%20by%20tidp%20is%20set%20to%20the%20thread%20ID%20of%20the%20newly%20created%20thread%20when%20pthread_create%20returns%20successfully%20pthread%20functions%20usually%20return%20an%20error%20code%20when%20they%20fail." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fadvanced_programming_in_the_unix_environment_threads%2f&t=APUE%3a%3aThreads" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2023 Y.CH.Y</div><div class=footer-right><nav><ul><li><a href=/>首页</a></li><li><a href=/books>笔记</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script></html>