<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-180x180.png" />
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> 八股文::操作系统 | Y.CH.Y</title>
  <link rel = 'canonical' href = '/interview/interview_questions_operating_system/'>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="八股文::操作系统" />
<meta property="og:description" content="操作系统 进程和线程之间有什么区别？ 进程间有哪些通信方式？ 简述 select, poll, epoll 的使用场景以及区别，epoll 中水平触发以及边缘触发有什么不同？ 简述 Linux 进程调度的算法 简述几个常用的 Linux 命令以及他们的功能 简述操作系统如何进行内存管理 线程有多少种状态，状态之间如何转换 简述操作系统中的缺页中断 线程间有哪些通信方式？ 什么时候会由用户态陷入内核态？ 进程有多少种状态？ 简述自旋锁与互斥锁的使用场景 Linux 下如何查看端口被哪个进程占用？ 操作系统中，虚拟地址与物理地址之间如何映射？ 进程通信中的管道实现原理是什么？ Linux 下如何排查 CPU 以及 内存占用过多？ 简述 Linux 系统态与用户态，什么时候会进入系统态？ 多线程和多进程的区别是什么？ 简述 Linux 虚拟内存的页面置换算法 创建线程有多少种方式？ 简述 Linux 零拷贝的原理 简述同步与异步的区别，阻塞与非阻塞的区别 Linux 中虚拟内存和物理内存有什么区别？有什么优点？ BIO、NIO 有什么区别？怎么判断写文件时 Buffer 已经写满？简述 Linux 的 IO 模型 简述 mmap 的使用场景以及原理 两个线程交替打印一个共享变量 简述操作系统中 malloc 的实现原理 Linux 下如何查看 CPU 荷载，正在运行的进程，某个端口对应的进程？ LVS 的 NAT、TUN、DR 原理及区别 共享内存是如何实现的？ 如何调试服务器内存占用过高的问题？ 系统调用的过程是怎样的？操作系统是通过什么机制触发系统调用的？ Linux 如何查看实时的滚动日志？ tail -f log 或者 tail -F log" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/interview/interview_questions_operating_system/" /><meta property="article:section" content="interview" />
<meta property="article:published_time" content="2021-08-21T03:28:49+08:00" />
<meta property="article:modified_time" content="2021-08-21T03:28:49+08:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="八股文::操作系统"/>
<meta name="twitter:description" content="操作系统 进程和线程之间有什么区别？ 进程间有哪些通信方式？ 简述 select, poll, epoll 的使用场景以及区别，epoll 中水平触发以及边缘触发有什么不同？ 简述 Linux 进程调度的算法 简述几个常用的 Linux 命令以及他们的功能 简述操作系统如何进行内存管理 线程有多少种状态，状态之间如何转换 简述操作系统中的缺页中断 线程间有哪些通信方式？ 什么时候会由用户态陷入内核态？ 进程有多少种状态？ 简述自旋锁与互斥锁的使用场景 Linux 下如何查看端口被哪个进程占用？ 操作系统中，虚拟地址与物理地址之间如何映射？ 进程通信中的管道实现原理是什么？ Linux 下如何排查 CPU 以及 内存占用过多？ 简述 Linux 系统态与用户态，什么时候会进入系统态？ 多线程和多进程的区别是什么？ 简述 Linux 虚拟内存的页面置换算法 创建线程有多少种方式？ 简述 Linux 零拷贝的原理 简述同步与异步的区别，阻塞与非阻塞的区别 Linux 中虚拟内存和物理内存有什么区别？有什么优点？ BIO、NIO 有什么区别？怎么判断写文件时 Buffer 已经写满？简述 Linux 的 IO 模型 简述 mmap 的使用场景以及原理 两个线程交替打印一个共享变量 简述操作系统中 malloc 的实现原理 Linux 下如何查看 CPU 荷载，正在运行的进程，某个端口对应的进程？ LVS 的 NAT、TUN、DR 原理及区别 共享内存是如何实现的？ 如何调试服务器内存占用过高的问题？ 系统调用的过程是怎样的？操作系统是通过什么机制触发系统调用的？ Linux 如何查看实时的滚动日志？ tail -f log 或者 tail -F log"/>

  
  
    
  
  
  <link rel="stylesheet" href="/css/styles.799e452986b367cc888ea5995bc8cc4c4fb66d5b504c0a16cb0fdf4b1bb86b68090b3a1fc8d9eb26985d905c306e7bc2eefe764f17ebdf7156e1873bba2e07e1.css" integrity="sha512-eZ5FKYazZ8yIjqWZW8jMTE&#43;2bVtQTAoWyw/fSxu4a2gJCzofyNnrJphdkFwwbnvC7v52Txfr33FW4Yc7ui4H4Q=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="/images/favicon.ico" />

  
  
  
  
  
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-X1L70M4MM0', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="/">
  
    <div id="logo" style="background-image: url(/images/logo.png)"></div>
  
  <div id="title">
    <h1>Y.CH.Y</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#" aria-label="Menu"><i class="fas fa-bars fa-2x" aria-hidden="true"></i></a>
      </li>
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/oc">课程</a></li>
      
        <li><a href="/algo">算法</a></li>
      
        <li><a href="/about">关于</a></li>
      
    </ul>
  </div>
</header>



    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    <h2 id="操作系统">操作系统</h2>
<h3 id="进程和线程之间有什么区别">进程和线程之间有什么区别？</h3>
<h3 id="进程间有哪些通信方式">进程间有哪些通信方式？</h3>
<h3 id="简述-select-poll-epoll-的使用场景以及区别epoll-中水平触发以及边缘触发有什么不同">简述 select, poll, epoll 的使用场景以及区别，epoll 中水平触发以及边缘触发有什么不同？</h3>
<h3 id="简述-linux-进程调度的算法">简述 Linux 进程调度的算法</h3>
<h3 id="简述几个常用的-linux-命令以及他们的功能">简述几个常用的 Linux 命令以及他们的功能</h3>
<h3 id="简述操作系统如何进行内存管理">简述操作系统如何进行内存管理</h3>
<h3 id="线程有多少种状态状态之间如何转换">线程有多少种状态，状态之间如何转换</h3>
<h3 id="简述操作系统中的缺页中断">简述操作系统中的缺页中断</h3>
<h3 id="线程间有哪些通信方式">线程间有哪些通信方式？</h3>
<h3 id="什么时候会由用户态陷入内核态">什么时候会由用户态陷入内核态？</h3>
<h3 id="进程有多少种状态">进程有多少种状态？</h3>
<h3 id="简述自旋锁与互斥锁的使用场景">简述自旋锁与互斥锁的使用场景</h3>
<h3 id="linux-下如何查看端口被哪个进程占用">Linux 下如何查看端口被哪个进程占用？</h3>
<h3 id="操作系统中虚拟地址与物理地址之间如何映射">操作系统中，虚拟地址与物理地址之间如何映射？</h3>
<h3 id="进程通信中的管道实现原理是什么">进程通信中的管道实现原理是什么？</h3>
<h3 id="linux-下如何排查-cpu-以及-内存占用过多">Linux 下如何排查 CPU 以及 内存占用过多？</h3>
<h3 id="简述-linux-系统态与用户态什么时候会进入系统态">简述 Linux 系统态与用户态，什么时候会进入系统态？</h3>
<h3 id="多线程和多进程的区别是什么">多线程和多进程的区别是什么？</h3>
<h3 id="简述-linux-虚拟内存的页面置换算法">简述 Linux 虚拟内存的页面置换算法</h3>
<h3 id="创建线程有多少种方式">创建线程有多少种方式？</h3>
<h3 id="简述-linux-零拷贝的原理">简述 Linux 零拷贝的原理</h3>
<h3 id="简述同步与异步的区别阻塞与非阻塞的区别">简述同步与异步的区别，阻塞与非阻塞的区别</h3>
<h3 id="linux-中虚拟内存和物理内存有什么区别有什么优点">Linux 中虚拟内存和物理内存有什么区别？有什么优点？</h3>
<h3 id="bionio-有什么区别怎么判断写文件时-buffer-已经写满简述-linux-的-io-模型">BIO、NIO 有什么区别？怎么判断写文件时 Buffer 已经写满？简述 Linux 的 IO 模型</h3>
<h3 id="简述-mmap-的使用场景以及原理">简述 mmap 的使用场景以及原理</h3>
<h3 id="两个线程交替打印一个共享变量">两个线程交替打印一个共享变量</h3>
<h3 id="简述操作系统中-malloc-的实现原理">简述操作系统中 malloc 的实现原理</h3>
<h3 id="linux-下如何查看-cpu-荷载正在运行的进程某个端口对应的进程">Linux 下如何查看 CPU 荷载，正在运行的进程，某个端口对应的进程？</h3>
<h3 id="lvs-的-nattundr-原理及区别">LVS 的 NAT、TUN、DR 原理及区别</h3>
<h3 id="共享内存是如何实现的">共享内存是如何实现的？</h3>
<h3 id="如何调试服务器内存占用过高的问题">如何调试服务器内存占用过高的问题？</h3>
<h3 id="系统调用的过程是怎样的操作系统是通过什么机制触发系统调用的">系统调用的过程是怎样的？操作系统是通过什么机制触发系统调用的？</h3>
<h3 id="linux-如何查看实时的滚动日志">Linux 如何查看实时的滚动日志？</h3>
<p><code>tail -f log</code> 或者 <code>tail -F log</code></p>
<h3 id="malloc-创建的对象在堆还是栈中">malloc 创建的对象在堆还是栈中？</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#00a8c8">void</span> <span style="color:#75af00">foo</span><span style="color:#111">()</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">int</span> <span style="color:#f92672">*</span><span style="color:#111">a_stack_pointer</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span><span style="color:#f92672">*</span><span style="color:#111">)</span><span style="color:#111">malloc</span><span style="color:#111">(</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span><span style="color:#111">));</span>
<span style="color:#111">}</span>
</code></pre></div><p>a_stack_pointer 在栈上，保存了它所指向的内容给的地址，用 malloc 分配的动态内存在堆上</p>
<h3 id="为什么进程切换慢线程切换快">为什么进程切换慢，线程切换快？</h3>
<h3 id="简述-cpu-l1-l2-l3-多级缓存的基本作用">简述 CPU L1, L2, L3 多级缓存的基本作用</h3>
<h3 id="简述创建进程的流程">简述创建进程的流程</h3>
<h3 id="进程空间从高位到低位都有些什么">进程空间从高位到低位都有些什么？</h3>
<h3 id="什么情况下进程会进行切换">什么情况下，进程会进行切换？</h3>
<h3 id="简述-linux-的-io-模型">简述 Linux 的 I/O 模型</h3>
<h3 id="简述-traceroute-命令的原理">简述 traceroute 命令的原理</h3>
<h3 id="linux-页大小是多少">Linux 页大小是多少？</h3>
<table>
<thead>
<tr>
<th>Architecture</th>
<th>Smallest page size</th>
<th>Larger page sizes</th>
</tr>
</thead>
<tbody>
<tr>
<td>32-bit x86</td>
<td>4 KiB</td>
<td>4 MiB in PSE mode, 2 MiB in PAE mode</td>
</tr>
<tr>
<td>x86-64</td>
<td>4 KiB</td>
<td>2 MiB, 1 GiB</td>
</tr>
<tr>
<td>IA-64 (Itanium)</td>
<td>4 KiB</td>
<td>8 KiB, 64 KiB, 256 KiB, 1 MiB, 4 MiB, 16 MiB, 256 MiB</td>
</tr>
<tr>
<td>Power ISA</td>
<td>4 KiB</td>
<td>64 KiB, 16 MiB, 16 GiB</td>
</tr>
<tr>
<td>SPARC v8 with SPARC Reference MMU</td>
<td>4 KiB</td>
<td>256 KiB, 16 MiB</td>
</tr>
<tr>
<td>UltraSPARC Architecture 2007 8 KiB 6</td>
<td>4 KiB</td>
<td>64KiB, 512 KiB , 4 MiB, 32 MiB , 256 MiB , 2 GiB , 16 GiB</td>
</tr>
<tr>
<td>ARMv7</td>
<td>4 KiB</td>
<td>64 KiB, 1 MiB , 16 MiB</td>
</tr>
</tbody>
</table>
<h3 id="信号量是如何实现的">信号量是如何实现的？</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#00a8c8">struct</span> <span style="color:#111">semaphore</span> <span style="color:#111">{</span>
    <span style="color:#111">raw_spinlock_t</span>        <span style="color:#111">lock</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">unsigned</span> <span style="color:#00a8c8">int</span>        <span style="color:#111">count</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">struct</span> <span style="color:#111">list_head</span>    <span style="color:#111">wait_list</span><span style="color:#111">;</span>
<span style="color:#111">};</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * down - acquire the semaphore
</span><span style="color:#75715e"> * @sem: the semaphore to be acquired
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * Acquires the semaphore.  If no more tasks are allowed to acquire the
</span><span style="color:#75715e"> * semaphore, calling this function will put the task to sleep until the
</span><span style="color:#75715e"> * semaphore is released.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * Use of this function is deprecated, please use down_interruptible() or
</span><span style="color:#75715e"> * down_killable() instead.
</span><span style="color:#75715e"> */</span>
<span style="color:#00a8c8">void</span> <span style="color:#75af00">down</span><span style="color:#111">(</span><span style="color:#00a8c8">struct</span> <span style="color:#111">semaphore</span> <span style="color:#f92672">*</span><span style="color:#111">sem</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">unsigned</span> <span style="color:#00a8c8">long</span> <span style="color:#111">flags</span><span style="color:#111">;</span>

    <span style="color:#111">raw_spin_lock_irqsave</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>
    <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">likely</span><span style="color:#111">(</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">count</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#111">))</span>
        <span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">count</span><span style="color:#f92672">--</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">else</span>
        <span style="color:#111">__down</span><span style="color:#111">(</span><span style="color:#111">sem</span><span style="color:#111">);</span>
    <span style="color:#111">raw_spin_unlock_irqrestore</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>
<span style="color:#111">}</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * down_interruptible - acquire the semaphore unless interrupted
</span><span style="color:#75715e"> * @sem: the semaphore to be acquired
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * Attempts to acquire the semaphore.  If no more tasks are allowed to
</span><span style="color:#75715e"> * acquire the semaphore, calling this function will put the task to sleep.
</span><span style="color:#75715e"> * If the sleep is interrupted by a signal, this function will return -EINTR.
</span><span style="color:#75715e"> * If the semaphore is successfully acquired, this function returns 0.
</span><span style="color:#75715e"> */</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">down_interruptible</span><span style="color:#111">(</span><span style="color:#00a8c8">struct</span> <span style="color:#111">semaphore</span> <span style="color:#f92672">*</span><span style="color:#111">sem</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">unsigned</span> <span style="color:#00a8c8">long</span> <span style="color:#111">flags</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>

    <span style="color:#111">raw_spin_lock_irqsave</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>
    <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">likely</span><span style="color:#111">(</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">count</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#111">))</span>
        <span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">count</span><span style="color:#f92672">--</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">else</span>
        <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#111">__down_interruptible</span><span style="color:#111">(</span><span style="color:#111">sem</span><span style="color:#111">);</span>
    <span style="color:#111">raw_spin_unlock_irqrestore</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>

    <span style="color:#00a8c8">return</span> <span style="color:#111">result</span><span style="color:#111">;</span>
<span style="color:#111">}</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * down_killable - acquire the semaphore unless killed
</span><span style="color:#75715e"> * @sem: the semaphore to be acquired
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * Attempts to acquire the semaphore.  If no more tasks are allowed to
</span><span style="color:#75715e"> * acquire the semaphore, calling this function will put the task to sleep.
</span><span style="color:#75715e"> * If the sleep is interrupted by a fatal signal, this function will return
</span><span style="color:#75715e"> * -EINTR.  If the semaphore is successfully acquired, this function returns
</span><span style="color:#75715e"> * 0.
</span><span style="color:#75715e"> */</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">down_killable</span><span style="color:#111">(</span><span style="color:#00a8c8">struct</span> <span style="color:#111">semaphore</span> <span style="color:#f92672">*</span><span style="color:#111">sem</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">unsigned</span> <span style="color:#00a8c8">long</span> <span style="color:#111">flags</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>

    <span style="color:#111">raw_spin_lock_irqsave</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>
    <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">likely</span><span style="color:#111">(</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">count</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#111">))</span>
        <span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">count</span><span style="color:#f92672">--</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">else</span>
        <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#111">__down_killable</span><span style="color:#111">(</span><span style="color:#111">sem</span><span style="color:#111">);</span>
    <span style="color:#111">raw_spin_unlock_irqrestore</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>

    <span style="color:#00a8c8">return</span> <span style="color:#111">result</span><span style="color:#111">;</span>
<span style="color:#111">}</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * down_trylock - try to acquire the semaphore, without waiting
</span><span style="color:#75715e"> * @sem: the semaphore to be acquired
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * Try to acquire the semaphore atomically.  Returns 0 if the semaphore has
</span><span style="color:#75715e"> * been acquired successfully or 1 if it cannot be acquired.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * NOTE: This return value is inverted from both spin_trylock and
</span><span style="color:#75715e"> * mutex_trylock!  Be careful about this when converting code.
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * Unlike mutex_trylock, this function can be used from interrupt context,
</span><span style="color:#75715e"> * and the semaphore can be released by any task or interrupt.
</span><span style="color:#75715e"> */</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">down_trylock</span><span style="color:#111">(</span><span style="color:#00a8c8">struct</span> <span style="color:#111">semaphore</span> <span style="color:#f92672">*</span><span style="color:#111">sem</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">unsigned</span> <span style="color:#00a8c8">long</span> <span style="color:#111">flags</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">count</span><span style="color:#111">;</span>

    <span style="color:#111">raw_spin_lock_irqsave</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>
    <span style="color:#111">count</span> <span style="color:#f92672">=</span> <span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">count</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">likely</span><span style="color:#111">(</span><span style="color:#111">count</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#111">))</span>
        <span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">count</span> <span style="color:#f92672">=</span> <span style="color:#111">count</span><span style="color:#111">;</span>
    <span style="color:#111">raw_spin_unlock_irqrestore</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>

    <span style="color:#00a8c8">return</span> <span style="color:#111">(</span><span style="color:#111">count</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span><span style="color:#111">);</span>
<span style="color:#111">}</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * down_timeout - acquire the semaphore within a specified time
</span><span style="color:#75715e"> * @sem: the semaphore to be acquired
</span><span style="color:#75715e"> * @timeout: how long to wait before failing
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * Attempts to acquire the semaphore.  If no more tasks are allowed to
</span><span style="color:#75715e"> * acquire the semaphore, calling this function will put the task to sleep.
</span><span style="color:#75715e"> * If the semaphore is not released within the specified number of jiffies,
</span><span style="color:#75715e"> * this function returns -ETIME.  It returns 0 if the semaphore was acquired.
</span><span style="color:#75715e"> */</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">down_timeout</span><span style="color:#111">(</span><span style="color:#00a8c8">struct</span> <span style="color:#111">semaphore</span> <span style="color:#f92672">*</span><span style="color:#111">sem</span><span style="color:#111">,</span> <span style="color:#00a8c8">long</span> <span style="color:#111">timeout</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">unsigned</span> <span style="color:#00a8c8">long</span> <span style="color:#111">flags</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>

    <span style="color:#111">raw_spin_lock_irqsave</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>
    <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">likely</span><span style="color:#111">(</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">count</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#111">))</span>
        <span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">count</span><span style="color:#f92672">--</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">else</span>
        <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#111">__down_timeout</span><span style="color:#111">(</span><span style="color:#111">sem</span><span style="color:#111">,</span> <span style="color:#111">timeout</span><span style="color:#111">);</span>
    <span style="color:#111">raw_spin_unlock_irqrestore</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>

    <span style="color:#00a8c8">return</span> <span style="color:#111">result</span><span style="color:#111">;</span>
<span style="color:#111">}</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * up - release the semaphore
</span><span style="color:#75715e"> * @sem: the semaphore to release
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * Release the semaphore.  Unlike mutexes, up() may be called from any
</span><span style="color:#75715e"> * context and even by tasks which have never called down().
</span><span style="color:#75715e"> */</span>
<span style="color:#00a8c8">void</span> <span style="color:#75af00">up</span><span style="color:#111">(</span><span style="color:#00a8c8">struct</span> <span style="color:#111">semaphore</span> <span style="color:#f92672">*</span><span style="color:#111">sem</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">unsigned</span> <span style="color:#00a8c8">long</span> <span style="color:#111">flags</span><span style="color:#111">;</span>

    <span style="color:#111">raw_spin_lock_irqsave</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>
    <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">likely</span><span style="color:#111">(</span><span style="color:#111">list_empty</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">wait_list</span><span style="color:#111">)))</span>
        <span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">count</span><span style="color:#f92672">++</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">else</span>
        <span style="color:#111">__up</span><span style="color:#111">(</span><span style="color:#111">sem</span><span style="color:#111">);</span>
    <span style="color:#111">raw_spin_unlock_irqrestore</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">sem</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lock</span><span style="color:#111">,</span> <span style="color:#111">flags</span><span style="color:#111">);</span>
<span style="color:#111">}</span>
</code></pre></div>
  
  </div>
</article>


    <footer id="footer">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
  <div class="footer-left">
    Copyright  &copy; 2021  Y.CH.Y 
    
    
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">首页</a></li>
         
        <li><a href="/oc">课程</a></li>
         
        <li><a href="/algo">算法</a></li>
         
        <li><a href="/about">关于</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
